"use strict";!function(e,a){function t(e){return e&&e.__esModule?e:{default:e}}var n=e.exports={};window=a("../../npm/labrador/global.js");Object.defineProperty(n,"__esModule",{value:!0});var r=a("../../npm/babel-runtime/regenerator/index.js"),u=t(r),s=a("../../npm/babel-runtime/helpers/asyncToGenerator.js"),l=t(s),o=a("../../npm/babel-runtime/core-js/object/get-prototype-of.js"),i=t(o),f=a("../../npm/babel-runtime/helpers/classCallCheck.js"),d=t(f),p=a("../../npm/babel-runtime/helpers/createClass.js"),c=t(p),h=a("../../npm/babel-runtime/helpers/possibleConstructorReturn.js"),b=t(h),g=a("../../npm/babel-runtime/helpers/inherits.js"),m=t(g),k=a("../../npm/labrador/index.js"),v=t(k),x=a("../../components/navbar/navbar.js"),w=t(x),I=function(e){function a(){var e,t,n,r;(0,d.default)(this,a);for(var u=arguments.length,s=Array(u),l=0;l<u;l++)s[l]=arguments[l];return t=n=(0,b.default)(this,(e=a.__proto__||(0,i.default)(a)).call.apply(e,[this].concat(s))),n.data={login:!1,userInfo:{},assetsPath:v.default.app.data.assetsPath,wxUserInfo:v.default.app.globalData.userInfo},n.children={navbar:new w.default({cur:2})},r=t,(0,b.default)(n,r)}return(0,m.default)(a,e),(0,c.default)(a,[{key:"linkTo",value:function(){function e(e){return a.apply(this,arguments)}var a=(0,l.default)(u.default.mark(function e(a){var t;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this,!this.isLink){e.next=3;break}return e.abrupt("return");case 3:if(this.isLink=!0,this.data.login){e.next=9;break}return e.next=7,v.default.app.doLogin(function(e){t.setData({login:!0,userInfo:e.data}),v.default.navigateTo({url:a.currentTarget.dataset.link})});case 7:e.next=11;break;case 9:return e.next=11,v.default.navigateTo({url:a.currentTarget.dataset.link});case 11:this.isLink=!1;case 12:case"end":return e.stop()}},e,this)}));return e}()},{key:"bindLogin",value:function(){function e(){return a.apply(this,arguments)}var a=(0,l.default)(u.default.mark(function e(){var a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=this,v.default.app.doLogin(function(e,t){a.setData({login:!0,userInfo:e.data,wxUserInfo:t})});case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"makePhoneCall",value:function(e){v.default.app.makePhoneCall(e)}},{key:"initAcount",value:function(){function e(){return a.apply(this,arguments)}var a=(0,l.default)(u.default.mark(function e(){var a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(v.default.app.globalData.storage||v.default.app.globalData.storage.code){e.next=4;break}this.setData({login:!1}),e.next=17;break;case 4:return e.next=6,v.default.app.getUser(v.default.app.globalData.storage.code);case 6:if(a=e.sent,!a.data.loginStatus){e.next=16;break}return a.data.nickName&&(v.default.app.globalData.userInfo.nickName=a.data.nickName),a.data.headImgUrl&&(v.default.app.globalData.userInfo.avatarUrl=a.data.headImgUrl),a.data.headImgUrl=v.default.app.setHttpsUrl(a.data.headImgUrl),this.setData({login:!0,userInfo:a.data,wxUserInfo:v.default.app.globalData.userInfo}),e.next=14,v.default.setStorage({key:"userInfo",data:this.globalData.userInfo});case 14:e.next=17;break;case 16:this.setData({login:!1});case 17:case"end":return e.stop()}},e,this)}));return e}()},{key:"onShow",value:function(){this.initAcount(),v.default.app.stopAudio()}},{key:"onPullDownRefresh",value:function(){function e(){return a.apply(this,arguments)}var a=(0,l.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initAcount();case 2:v.default.stopPullDownRefresh();case 3:case"end":return e.stop()}},e,this)}));return e}()}]),a}(v.default.Component);Page(k._createPage(I))}(module,require);