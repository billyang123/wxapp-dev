"use strict";!function(e,t){function n(e){return e&&e.__esModule?e:{default:e}}var a=e.exports={};window=t("../../npm/labrador/global.js");Object.defineProperty(a,"__esModule",{value:!0});var r=t("../../npm/babel-runtime/regenerator/index.js"),s=n(r),i=t("../../npm/babel-runtime/core-js/json/stringify.js"),o=n(i),d=t("../../npm/babel-runtime/helpers/asyncToGenerator.js"),c=n(d),u=t("../../npm/babel-runtime/core-js/object/get-prototype-of.js"),h=n(u),l=t("../../npm/babel-runtime/helpers/classCallCheck.js"),p=n(l),f=t("../../npm/babel-runtime/helpers/createClass.js"),m=n(f),b=t("../../npm/babel-runtime/helpers/possibleConstructorReturn.js"),v=n(b),k=t("../../npm/babel-runtime/helpers/inherits.js"),x=n(k),g=t("../../npm/labrador/index.js"),y=n(g),j=t("../../components/alert/alert.js"),w=n(j),C={items:[{convention:"《17互助公约》",checked:"true"},{convention:"《789重大疾病互助公约》",checked:"true",condition:"加入条件：适用于18-46周岁，在加入互助社群之前，未曾患有互助公约所描述的25种重大疾病的人群。",remind:"请在加入本互助社群前咨询家人，避免重复加入。"},{convention:"《留守儿童互助公约》",checked:"true",condition:"加入条件：3-15周岁，父母双方或一方在外地打工，而自己留在农村生活的孩童，或不在父母身边的城市孩童，在加入互助社群之前，未曾患有互助公约所描述的25种重大疾病的人群。",remind:""},{convention:"《公共交通、旅游意外互助公约》",checked:"true",condition:"加入条件：16-60周岁。",remind:"请在加入本互助社群前咨询家人，避免重复加入。"},{convention:"《少儿大病、意外互助计划公约》",checked:"true",condition:"加入条件：1周岁－未满18周岁健康青少年在加入互助社群之前，未曾患有互助公约所描述的25种重大疾病的人群。",remind:"请在加入本互助社群前咨询家人，避免重复加入。"},{convention:"《80后孕妈婴宝互助公约》",checked:"true",condition:"加入条件：未满36周岁的孕妈妈或者备孕妈妈，加入之日怀孕周期未超过24周。在加入互助社群之前，未曾患有互助公约所描述的疾病的人群",remind:"请在加入本互助社群前咨询家人，避免重复加入。"},{convention:"《中老年大病意外互助公约》",checked:"true",condition:"加入条件：46-70周岁，在加入互助社群之前，未曾患有互助公约所描述的恶性肿瘤或24种重大疾病的人群。",remind:"请在加入本互助社群前咨询家人，避免重复加入。"}]},D=function(e){function t(){var e,n,a,r;(0,p.default)(this,t);for(var s=arguments.length,i=Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=a=(0,v.default)(this,(e=t.__proto__||(0,h.default)(t)).call.apply(e,[this].concat(i))),a.data={projectId:1,persons:[{}],publicConvention:"",conventionTxt:"",publicChecked:!0,checked:!0,conditionTxt:"",bl:!0,checkedValue:["1","2"]},a.children={alert:new w.default({msg:"@msg"})},r=n,(0,v.default)(a,r)}return(0,x.default)(t,e),(0,m.default)(t,[{key:"addPerson",value:function(e){for(var t=0;t<this.data.persons.length;t++){if("undefined"==typeof this.data.persons[t].name)return void this.children.alert.show("请输入正确姓名");if("undefined"==typeof this.data.persons[t].cardCode)return void this.children.alert.show("请输入有效身份证号");if(!this.data.persons[t].name.length>0)return void this.children.alert.show("请输入正确姓名");if(!this.checkisIDCard(this.data.persons[t].cardCode))return void this.children.alert.show("请输入有效身份证号")}this.data.persons.push({}),this.setData({persons:this.data.persons})}},{key:"removePerson",value:function(e){if(1!=this.data.persons.length){var t=e.currentTarget.dataset.idx;this.data.persons.splice(parseInt(t),1),this.setData({persons:this.data.persons})}}},{key:"checkChange",value:function(e){this.setData({checkedValue:e.detail.value})}},{key:"checkisIDCard",value:function(e){var t=/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X|x)$/;return!!t.test(e)}},{key:"showAlert",value:function(e){var t=this;this.Animation||(this.Animation=y.default.createAnimation({duration:400,timingFunction:"ease"})),this.Animation.height("70rpx").step(),this.setData({error:{msg:e,anim:this.Animation.export()}}),setTimeout(function(){this.Animation.height(0).step(),t.setData({error:{anim:t.Animation.export()}})},3e3)}},{key:"joinBind",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c.default)(s.default.mark(function e(t){var n,a,r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.status){e.next=2;break}return e.abrupt("return");case 2:this.status=!0,console.log(this.data.persons),n=0;case 5:if(!(n<this.data.persons.length)){e.next=29;break}if("undefined"!=typeof this.data.persons[n].name){e.next=10;break}return this.children.alert.show("请输入正确姓名"),this.status=!1,e.abrupt("return");case 10:if("undefined"!=typeof this.data.persons[n].cardCode){e.next=14;break}return this.children.alert.show("请输入有效身份证号"),this.status=!1,e.abrupt("return");case 14:if(!(!this.data.persons[n].name.length>0)){e.next=18;break}return this.children.alert.show("请输入正确姓名"),this.status=!1,e.abrupt("return");case 18:if(this.checkisIDCard(this.data.persons[n].cardCode)){e.next=22;break}return this.children.alert.show("请输入有效身份证号"),this.status=!1,e.abrupt("return");case 22:if(!(this.data.checkedValue.length<2)){e.next=26;break}return this.children.alert.show("加入前请先同意社群公约"),this.status=!1,e.abrupt("return");case 26:n++,e.next=5;break;case 29:if(!this.data.bl){e.next=44;break}return this.setData({bl:!1}),e.next=33,y.default.request({url:"https://xcx.chinamuxie.com/wxapi/project/join/byIdCardPay",header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",data:{projectId:this.data.projectId,persons:(0,o.default)(this.data.persons),code:y.default.app.globalData.storage.code}});case 33:if(a=e.sent,0!=a.data.status){e.next=42;break}return e.next=37,y.default.requestPayment(a.data.data);case 37:return r=e.sent,e.next=40,y.default.redirectTo({url:"/pages/joinEnd/joinEnd"});case 40:e.next=43;break;case 42:y.default.showModal({title:"提示",content:a.data.msg,showCancel:!1,success:function(e){e.confirm&&console.log("用户点击确定")}});case 43:this.setData({bl:!0});case 44:this.status=!1;case 45:case"end":return e.stop()}},e,this)}));return e}()},{key:"bindKeyInput",value:function(e){var t=e.currentTarget.dataset.name,n=e.currentTarget.dataset.idx;this.data.persons[n][t]=e.detail.value,this.setData({persons:this.data.persons})}},{key:"onLoad",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c.default)(s.default.mark(function e(t){var n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=parseInt(t.type),this.setData({publicConvention:C.items[0].convention,conventionTxt:C.items[n].convention,projectId:n,conditionTxt:C.items[n].condition});case 2:case"end":return e.stop()}},e,this)}));return e}()}]),t}(y.default.Component);Page(g._createPage(D))}(module,require);