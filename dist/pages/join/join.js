"use strict";!function(t,e){function a(t){return t&&t.__esModule?t:{default:t}}var n=t.exports={};window=e("../../npm/labrador/global.js");Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../npm/babel-runtime/regenerator/index.js"),s=a(r),i=e("../../npm/babel-runtime/core-js/json/stringify.js"),o=a(i),d=e("../../npm/babel-runtime/helpers/asyncToGenerator.js"),c=a(d),u=e("../../npm/babel-runtime/core-js/object/get-prototype-of.js"),h=a(u),l=e("../../npm/babel-runtime/helpers/classCallCheck.js"),p=a(l),f=e("../../npm/babel-runtime/helpers/createClass.js"),m=a(f),k=e("../../npm/babel-runtime/helpers/possibleConstructorReturn.js"),b=a(k),v=e("../../npm/babel-runtime/helpers/inherits.js"),g=a(v),x=e("../../npm/labrador/index.js"),y=a(x),j=e("../../components/alert/alert.js"),w=a(j),A={totalAmt:0,items:[{convention:"《17互助公约》",checked:"true",link:"/pages/hzpact/hzpact?type=1"},{convention:"《789重大疾病互助公约》",checked:"true",condition:"加入条件：适用于18-46周岁，在加入互助社群之前，未曾患有互助公约所描述的25种重大疾病的人群。",remind:"请在加入本互助社群前咨询家人，避免重复加入。",link:"/pages/hzpact/hzpact?type=14"},{convention:"《留守儿童互助公约》",checked:"true",condition:"加入条件：3-15周岁，父母双方或一方在外地打工，而自己留在农村生活的孩童，或不在父母身边的城市孩童，在加入互助社群之前，未曾患有互助公约所描述的25种重大疾病的人群。",remind:"",link:"/pages/packlist/packlist?id=1"},{convention:"《公共交通、旅游意外互助公约》",checked:"true",condition:"加入条件：16-60周岁。",remind:"请在加入本互助社群前咨询家人，避免重复加入。",link:"/pages/hzpact/hzpact?type=11"},{convention:"《少儿大病、意外互助计划公约》",checked:"true",condition:"加入条件：1周岁－未满18周岁健康青少年在加入互助社群之前，未曾患有互助公约所描述的25种重大疾病的人群。",remind:"请在加入本互助社群前咨询家人，避免重复加入。",link:"/pages/packlist/packlist?id=2"},{convention:"《80后孕妈婴宝互助公约》",checked:"true",condition:"加入条件：未满36周岁的孕妈妈或者备孕妈妈，加入之日怀孕周期未超过24周。在加入互助社群之前，未曾患有互助公约所描述的疾病的人群",remind:"请在加入本互助社群前咨询家人，避免重复加入。",link:"/pages/hzpact/hzpact?type=8"},{convention:"《中老年大病意外互助公约》",checked:"true",condition:"加入条件：46-70周岁，在加入互助社群之前，未曾患有互助公约所描述的恶性肿瘤或24种重大疾病的人群。",remind:"请在加入本互助社群前咨询家人，避免重复加入。",link:"/pages/packlist/packlist?id=3"}]},C=function(t){function e(){var t,a,n,r;(0,p.default)(this,e);for(var s=arguments.length,i=Array(s),o=0;o<s;o++)i[o]=arguments[o];return a=n=(0,b.default)(this,(t=e.__proto__||(0,h.default)(e)).call.apply(t,[this].concat(i))),n.data={projectId:1,persons:[{}],publicConvention:"",conventionTxt:"",publicChecked:!0,checked:!0,conditionTxt:"",bl:!0,checkedValue:["1","2"]},n.children={alert:new w.default({msg:"@msg"})},r=a,(0,b.default)(n,r)}return(0,g.default)(e,t),(0,m.default)(e,[{key:"addPerson",value:function(t){for(var e=0;e<this.data.persons.length;e++){if("undefined"==typeof this.data.persons[e].name)return void this.children.alert.show("请输入正确姓名");if("undefined"==typeof this.data.persons[e].cardCode)return void this.children.alert.show("请输入有效身份证号");if(!this.data.persons[e].name.length>0)return void this.children.alert.show("请输入正确姓名");if(!this.checkisIDCard(this.data.persons[e].cardCode))return void this.children.alert.show("请输入有效身份证号")}this.data.persons.push({}),this.setData({persons:this.data.persons,totalAmt:this.initAmt*this.data.persons.length})}},{key:"removePerson",value:function(t){if(1!=this.data.persons.length){var e=t.currentTarget.dataset.idx;this.data.persons.splice(parseInt(e),1),this.setData({persons:this.data.persons,totalAmt:this.initAmt*this.data.persons.length})}}},{key:"checkChange",value:function(t){this.setData({checkedValue:t.detail.value})}},{key:"checkisIDCard",value:function(t){var e=/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X|x)$/;return!!e.test(t)}},{key:"showAlert",value:function(t){var e=this;this.Animation||(this.Animation=y.default.createAnimation({duration:400,timingFunction:"ease"})),this.Animation.height("70rpx").step(),this.setData({error:{msg:t,anim:this.Animation.export()}}),setTimeout(function(){this.Animation.height(0).step(),e.setData({error:{anim:e.Animation.export()}})},3e3)}},{key:"joinBind",value:function(){function t(t){return e.apply(this,arguments)}var e=(0,c.default)(s.default.mark(function t(e){var a,n,r;return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.status){t.next=2;break}return t.abrupt("return");case 2:this.status=!0,a=0;case 4:if(!(a<this.data.persons.length)){t.next=28;break}if("undefined"!=typeof this.data.persons[a].name){t.next=9;break}return this.children.alert.show("请输入正确姓名"),this.status=!1,t.abrupt("return");case 9:if("undefined"!=typeof this.data.persons[a].cardCode){t.next=13;break}return this.children.alert.show("请输入有效身份证号"),this.status=!1,t.abrupt("return");case 13:if(!(!this.data.persons[a].name.length>0)){t.next=17;break}return this.children.alert.show("请输入正确姓名"),this.status=!1,t.abrupt("return");case 17:if(this.checkisIDCard(this.data.persons[a].cardCode)){t.next=21;break}return this.children.alert.show("请输入有效身份证号"),this.status=!1,t.abrupt("return");case 21:if(!(this.data.checkedValue.length<2)){t.next=25;break}return this.children.alert.show("加入前请先同意社群公约"),this.status=!1,t.abrupt("return");case 25:a++,t.next=4;break;case 28:return t.next=30,y.default.request({url:y.default.app.data.ajaxPath+"/wxapi/project/join/byIdCardPay",header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",data:{projectId:this.data.projectId,persons:(0,o.default)(this.data.persons),code:y.default.app.globalData.storage.code}});case 30:if(n=t.sent,this.status=!1,0!=n.data.status){t.next=40;break}return t.next=35,y.default.requestPayment(n.data.data);case 35:return r=t.sent,t.next=38,y.default.redirectTo({url:"/pages/joinEnd/joinEnd"});case 38:t.next=41;break;case 40:y.default.showModal({title:"提示",content:n.data.msg,showCancel:!1});case 41:case"end":return t.stop()}},t,this)}));return t}()},{key:"bindKeyInput",value:function(t){var e=t.currentTarget.dataset.name,a=t.currentTarget.dataset.idx;this.data.persons[a][e]=t.detail.value,this.setData({persons:this.data.persons})}},{key:"onLoad",value:function(){function t(t){return e.apply(this,arguments)}var e=(0,c.default)(s.default.mark(function t(e){var a,n;return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=parseInt(e.type),t.next=3,y.default.app.ajax({url:y.default.app.data.ajaxPath+"/wxapi/project/detail",type:"get",data:{id:a}});case 3:n=t.sent,this.initAmt=n.data.initAmt,this.setData({totalAmt:this.initAmt,publicConvention:A.items[0].convention,conventionTxt:A.items[a].convention,projectId:a,link:A.items[a].link,conditionTxt:A.items[a].condition});case 6:case"end":return t.stop()}},t,this)}));return t}()}]),e}(y.default.Component);Page(x._createPage(C))}(module,require);