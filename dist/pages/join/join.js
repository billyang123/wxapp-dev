"use strict";!function(t,e){function n(t){return t&&t.__esModule?t:{default:t}}var a=t.exports={};window=e("../../npm/labrador/global.js");Object.defineProperty(a,"__esModule",{value:!0});var r=e("../../npm/babel-runtime/regenerator/index.js"),s=n(r),i=e("../../npm/babel-runtime/core-js/json/stringify.js"),o=n(i),d=e("../../npm/babel-runtime/helpers/asyncToGenerator.js"),c=n(d),u=e("../../npm/babel-runtime/core-js/object/get-prototype-of.js"),h=n(u),l=e("../../npm/babel-runtime/helpers/classCallCheck.js"),p=n(l),f=e("../../npm/babel-runtime/helpers/createClass.js"),m=n(f),b=e("../../npm/babel-runtime/helpers/possibleConstructorReturn.js"),v=n(b),x=e("../../npm/babel-runtime/helpers/inherits.js"),k=n(x),g=e("../../npm/labrador/index.js"),j=n(g),y=e("../../components/alert/alert.js"),w=n(y),A={totalAmt:0,items:[{convention:"《17互助公约》",checked:"true"},{convention:"《789重大疾病互助公约》",checked:"true",condition:"加入条件：适用于18-46周岁，在加入互助社群之前，未曾患有互助公约所描述的25种重大疾病的人群。",remind:"请在加入本互助社群前咨询家人，避免重复加入。"},{convention:"《留守儿童互助公约》",checked:"true",condition:"加入条件：3-15周岁，父母双方或一方在外地打工，而自己留在农村生活的孩童，或不在父母身边的城市孩童，在加入互助社群之前，未曾患有互助公约所描述的25种重大疾病的人群。",remind:""},{convention:"《公共交通、旅游意外互助公约》",checked:"true",condition:"加入条件：16-60周岁。",remind:"请在加入本互助社群前咨询家人，避免重复加入。"},{convention:"《少儿大病、意外互助计划公约》",checked:"true",condition:"加入条件：1周岁－未满18周岁健康青少年在加入互助社群之前，未曾患有互助公约所描述的25种重大疾病的人群。",remind:"请在加入本互助社群前咨询家人，避免重复加入。"},{convention:"《80后孕妈婴宝互助公约》",checked:"true",condition:"加入条件：未满36周岁的孕妈妈或者备孕妈妈，加入之日怀孕周期未超过24周。在加入互助社群之前，未曾患有互助公约所描述的疾病的人群",remind:"请在加入本互助社群前咨询家人，避免重复加入。"},{convention:"《中老年大病意外互助公约》",checked:"true",condition:"加入条件：46-70周岁，在加入互助社群之前，未曾患有互助公约所描述的恶性肿瘤或24种重大疾病的人群。",remind:"请在加入本互助社群前咨询家人，避免重复加入。"}]},C=function(t){function e(){var t,n,a,r;(0,p.default)(this,e);for(var s=arguments.length,i=Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=a=(0,v.default)(this,(t=e.__proto__||(0,h.default)(e)).call.apply(t,[this].concat(i))),a.data={projectId:1,persons:[{}],publicConvention:"",conventionTxt:"",publicChecked:!0,checked:!0,conditionTxt:"",bl:!0,checkedValue:["1","2"]},a.children={alert:new w.default({msg:"@msg"})},r=n,(0,v.default)(a,r)}return(0,k.default)(e,t),(0,m.default)(e,[{key:"addPerson",value:function(t){for(var e=0;e<this.data.persons.length;e++){if("undefined"==typeof this.data.persons[e].name)return void this.children.alert.show("请输入正确姓名");if("undefined"==typeof this.data.persons[e].cardCode)return void this.children.alert.show("请输入有效身份证号");if(!this.data.persons[e].name.length>0)return void this.children.alert.show("请输入正确姓名");if(!this.checkisIDCard(this.data.persons[e].cardCode))return void this.children.alert.show("请输入有效身份证号")}this.data.persons.push({}),this.setData({persons:this.data.persons,totalAmt:this.initAmt*this.data.persons.length})}},{key:"removePerson",value:function(t){if(1!=this.data.persons.length){var e=t.currentTarget.dataset.idx;this.data.persons.splice(parseInt(e),1),this.setData({persons:this.data.persons,totalAmt:this.initAmt*this.data.persons.length})}}},{key:"checkChange",value:function(t){this.setData({checkedValue:t.detail.value})}},{key:"checkisIDCard",value:function(t){var e=/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X|x)$/;return!!e.test(t)}},{key:"showAlert",value:function(t){var e=this;this.Animation||(this.Animation=j.default.createAnimation({duration:400,timingFunction:"ease"})),this.Animation.height("70rpx").step(),this.setData({error:{msg:t,anim:this.Animation.export()}}),setTimeout(function(){this.Animation.height(0).step(),e.setData({error:{anim:e.Animation.export()}})},3e3)}},{key:"joinBind",value:function(){function t(t){return e.apply(this,arguments)}var e=(0,c.default)(s.default.mark(function t(e){var n,a,r;return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.status){t.next=2;break}return t.abrupt("return");case 2:this.status=!0,console.log(this.data.persons),n=0;case 5:if(!(n<this.data.persons.length)){t.next=29;break}if("undefined"!=typeof this.data.persons[n].name){t.next=10;break}return this.children.alert.show("请输入正确姓名"),this.status=!1,t.abrupt("return");case 10:if("undefined"!=typeof this.data.persons[n].cardCode){t.next=14;break}return this.children.alert.show("请输入有效身份证号"),this.status=!1,t.abrupt("return");case 14:if(!(!this.data.persons[n].name.length>0)){t.next=18;break}return this.children.alert.show("请输入正确姓名"),this.status=!1,t.abrupt("return");case 18:if(this.checkisIDCard(this.data.persons[n].cardCode)){t.next=22;break}return this.children.alert.show("请输入有效身份证号"),this.status=!1,t.abrupt("return");case 22:if(!(this.data.checkedValue.length<2)){t.next=26;break}return this.children.alert.show("加入前请先同意社群公约"),this.status=!1,t.abrupt("return");case 26:n++,t.next=5;break;case 29:if(!this.data.bl){t.next=44;break}return this.setData({bl:!1}),t.next=33,j.default.request({url:"https://xcx.chinamuxie.com/wxapi/project/join/byIdCardPay",header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",data:{projectId:this.data.projectId,persons:(0,o.default)(this.data.persons),code:j.default.app.globalData.storage.code}});case 33:if(a=t.sent,0!=a.data.status){t.next=42;break}return t.next=37,j.default.requestPayment(a.data.data);case 37:return r=t.sent,t.next=40,j.default.redirectTo({url:"/pages/joinEnd/joinEnd"});case 40:t.next=43;break;case 42:j.default.showModal({title:"提示",content:a.data.msg,showCancel:!1});case 43:this.setData({bl:!0});case 44:this.status=!1;case 45:case"end":return t.stop()}},t,this)}));return t}()},{key:"bindKeyInput",value:function(t){var e=t.currentTarget.dataset.name,n=t.currentTarget.dataset.idx;this.data.persons[n][e]=t.detail.value,this.setData({persons:this.data.persons})}},{key:"onLoad",value:function(){function t(t){return e.apply(this,arguments)}var e=(0,c.default)(s.default.mark(function t(e){var n,a;return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=parseInt(e.type),t.next=3,j.default.app.ajax({url:"https://xcx.chinamuxie.com/wxapi/project/detail",type:"get",data:{id:n}});case 3:a=t.sent,this.initAmt=a.data.initAmt,this.setData({totalAmt:this.initAmt,publicConvention:A.items[0].convention,conventionTxt:A.items[n].convention,projectId:n,conditionTxt:A.items[n].condition});case 6:case"end":return t.stop()}},t,this)}));return t}()}]),e}(j.default.Component);Page(g._createPage(C))}(module,require);