"use strict";!function(t,e){function a(t){return t&&t.__esModule?t:{default:t}}var n=t.exports={};window=e("../../npm/labrador/global.js");Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../npm/babel-runtime/regenerator/index.js"),s=a(r),o=e("../../npm/babel-runtime/helpers/asyncToGenerator.js"),u=a(o),l=e("../../npm/babel-runtime/core-js/object/get-prototype-of.js"),d=a(l),i=e("../../npm/babel-runtime/helpers/classCallCheck.js"),c=a(i),p=e("../../npm/babel-runtime/helpers/createClass.js"),f=a(p),m=e("../../npm/babel-runtime/helpers/possibleConstructorReturn.js"),h=a(m),b=e("../../npm/babel-runtime/helpers/inherits.js"),g=a(b),v=e("../../npm/labrador/index.js"),x=a(v),y=e("../../components/alert/alert.js"),q=a(y),k=function(t){function e(){var t,a,n,r;(0,c.default)(this,e);for(var s=arguments.length,o=Array(s),u=0;u<s;u++)o[u]=arguments[u];return a=n=(0,h.default)(this,(t=e.__proto__||(0,d.default)(e)).call.apply(t,[this].concat(o))),n.data={qid:"",cid:"",url:"",content:""},n.children={alert:new q.default({msg:"@msg"})},r=a,(0,h.default)(n,r)}return(0,g.default)(e,t),(0,f.default)(e,[{key:"formSubmit",value:function(){function t(t){return e.apply(this,arguments)}var e=(0,u.default)(s.default.mark(function t(e){var a,n,r,o,u,l;return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.detail.value.content,a=a.replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,""),""!=a){t.next=4;break}return t.abrupt("return",this.children.alert.show("请输入评论内容"));case 4:if(!(a.length>=60)){t.next=6;break}return t.abrupt("return",this.children.alert.show("评论内容需少于60个字"));case 6:return this.postdata.content=a,t.next=9,x.default.app.ajax({url:this.url,type:"post",data:this.postdata});case 9:if(n=t.sent,0!=n.status){t.next=24;break}return t.next=13,x.default.getStorage({key:"userInfo"});case 13:return r=t.sent,console.log(r),t.next=17,x.default.showToast({title:"评论成功",icon:"success",duration:2e3});case 17:return o=new Date,u={resId:n.data,avatar:r.data.avatarUrl.substring(0,r.data.avatarUrl.length-1)+96,nickName:r.data.nickName,content:a,time:o.format("yyyy/MM/dd HH:mm:ss")},this.postdata.qaCommentId?u.qaCommentId=this.postdata.qaCommentId:u.qaId=this.postdata.qaId,t.next=22,x.default.setStorage({key:"commit",data:u});case 22:this.setData({content:""}),setTimeout(function(){x.default.navigateBack()},2e3);case 24:if(1!=n.status){t.next=29;break}return t.next=27,x.default.showModal({title:"提示",content:"需要先登录"});case 27:l=t.sent,l.confirm&&x.default.redirectTo({url:"/pages/account/account"});case 29:case"end":return t.stop()}},t,this)}));return t}()},{key:"onShow",value:function(){function t(){return e.apply(this,arguments)}var e=(0,u.default)(s.default.mark(function t(){return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return x.default.app.stopAudio(),t.next=3,x.default.setStorage({key:"commit",data:{}});case 3:case"end":return t.stop()}},t,this)}));return t}()},{key:"onLoad",value:function(){function t(t){return e.apply(this,arguments)}var e=(0,u.default)(s.default.mark(function t(e){return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:x.default.app.stopAudio(),console.log(e),this.postdata={code:x.default.app.globalData.storage.code},e.qaCommentId&&(this.postdata.qaCommentId=e.qaCommentId,this.qaId=e["amp;qaId"],this.url=x.default.app.data.ajaxPath+"/wxapi/healthserv/qacomment/reply"),e.qaId&&(this.postdata.qaId=e.qaId,this.qaId=e.qaId,this.url=x.default.app.data.ajaxPath+"/wxapi/healthserv/qacomment/add"),console.log(e);case 6:case"end":return t.stop()}},t,this)}));return t}()}]),e}(x.default.Component);Page(v._createPage(k))}(module,require);