"use strict";!function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}var n=e.exports={};window=t("./npm/labrador/global.js");Object.defineProperty(n,"__esModule",{value:!0});var r=t("./npm/babel-runtime/regenerator/index.js"),u=a(r),s=t("./npm/babel-runtime/helpers/asyncToGenerator.js"),o=a(s),i=t("./npm/babel-runtime/helpers/classCallCheck.js"),c=a(i),l=t("./npm/babel-runtime/helpers/createClass.js"),f=a(l),d=t("./npm/labrador/index.js"),p=a(d);t("./utils/util.js");Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},a={0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(e)&&(e=e.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+a[this.getDay()+""]));for(var n in t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e};var h=function(){function e(){(0,c.default)(this,e),this.globalData={userInfo:null,storage:null},this.data={assetsPath:"https://s1.chinamuxie.com/www/assets/xcx"}}return(0,f.default)(e,[{key:"onLaunch",value:function(){function e(){return t.apply(this,arguments)}var t=(0,o.default)(u.default.mark(function e(){var t;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.next=3,this.__init();case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"makePhoneCall",value:function(e){p.default.showModal({title:"拨打电话："+e.currentTarget.dataset.phoneNumber,success:function(t){p.default.makePhoneCall({phoneNumber:e.currentTarget.dataset.phoneNumber})}})}},{key:"__init",value:function(){function e(){return t.apply(this,arguments)}var t=(0,o.default)(u.default.mark(function e(){var t;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStorage();case 2:if(this.globalData.storage=e.sent,this.globalData.storage&&(!this.globalData.storage||this.globalData.storage.code)){e.next=9;break}return e.next=6,p.default.login();case 6:return t=e.sent,e.next=9,p.default.setStorage({key:"code",data:t.code});case 9:return e.next=11,this.getUserInfo();case 11:return e.next=13,this.getStorage();case 13:this.globalData.storage=e.sent;case 14:case"end":return e.stop()}},e,this)}));return e}()},{key:"getStorage",value:function(){function e(){return t.apply(this,arguments)}var t=(0,o.default)(u.default.mark(function e(){var t,a,n,r,s;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.next=3,p.default.getStorageInfo();case 3:a=e.sent,n=a.keys,r=0;case 6:if(!(r<n.length)){e.next=14;break}return e.next=9,p.default.getStorage({key:n[r]});case 9:s=e.sent,t[n[r]]=s.data||"";case 11:r++,e.next=6;break;case 14:return e.abrupt("return",t);case 15:case"end":return e.stop()}},e,this)}));return e}()},{key:"getUserInfo",value:function(){function e(){return t.apply(this,arguments)}var t=(0,o.default)(u.default.mark(function e(){var t;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.default.getUserInfo();case 2:return t=e.sent,this.globalData.userInfo=t.userInfo,e.abrupt("return",t.userInfo);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"bindLogin",value:function(){function e(e,a){return t.apply(this,arguments)}var t=(0,o.default)(u.default.mark(function e(t,a){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.checkLogin(t,a);case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"checkLogin",value:function(){function e(e,a){return t.apply(this,arguments)}var t=(0,o.default)(u.default.mark(function e(t,a){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.doLogin(t,a);case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"doLogin",value:function(){function e(e,a){return t.apply(this,arguments)}var t=(0,o.default)(u.default.mark(function e(t,a){var n,r,s,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=3;break}return p.default.navigateTo({url:t}),e.abrupt("return");case 3:if(n={code:p.default.app.globalData.storage.code,sessionKey:p.default.app.globalData.storage.sessionKey},n.sessionKey){e.next=13;break}return e.next=7,p.default.request({url:"https://xcx.chinamuxie.com/wxapi/user/oauth/wxLogin",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:n});case 7:return r=e.sent,e.next=10,p.default.setStorage({key:"sessionKey",data:r.data.data});case 10:return e.next=12,p.default.app.getStorage();case 12:p.default.app.globalData.storage=e.sent;case 13:return e.next=15,p.default.getUserInfo();case 15:return s=e.sent,e.next=18,p.default.request({url:"https://xcx.chinamuxie.com/wxapi/user/oauth/doOauth",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{rawData:s.rawData,signature:s.signature,encryptedData:encodeURIComponent(s.encryptedData),iv:encodeURIComponent(s.iv),sessionKey:p.default.app.globalData.storage.sessionKey,code:n.code}});case 18:if(o=e.sent,"logged"==o.data.data&&p.default.navigateTo({url:t}),"notLogged"!=o.data.data){e.next=23;break}return e.next=23,p.default.navigateTo({url:"/pages/bindphone/bindphone"});case 23:case"end":return e.stop()}},e,this)}));return e}()},{key:"ajax",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,o.default)(u.default.mark(function e(t){var a,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={url:t.url,method:t.type||"get",header:{"content-type":"application/x-www-form-urlencoded"}},t.data&&(a.data=t.data),e.next=4,p.default.request(a);case 4:if(n=e.sent,200!=n.statusCode){e.next=9;break}return e.abrupt("return",n.data);case 9:p.default.showModal({title:"提示",content:n.errMsg,success:function(e){e.confirm&&console.log("用户点击确定")}});case 10:case"end":return e.stop()}},e,this)}));return e}()}]),e}();n.default=h;var g=new n.default;Object.getOwnPropertyNames(g.constructor.prototype).forEach(function(e){"constructor"!==e&&(g[e]=g.constructor.prototype[e])}),App(g)}(module,require);